---
import { getCollection } from "astro:content";
import Layout from "../../components/layout.astro";
import { prepareURL } from "../../lib/URL-helpers";
const posts = await getCollection("blog");
const sortedPosts = posts.sort(
  (a, b) => b.data.date.getTime() - a.data.date.getTime()
);

function formatDate(date: Date): string {
  return date.toLocaleDateString("en-US", {
    year: "numeric",
    month: "long",
    day: "numeric",
  });
}
---

<Layout>
  <section
    class="pt-32 pb-20 bg-gradient-to-b from-gray-50 to-white dark:from-gray-900 dark:to-gray-800"
  >
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center max-w-3xl mx-auto mb-16">
        <h1
          class="text-5xl md:text-6xl font-bold mb-6 text-gray-900 dark:text-white"
        >
          Our Blog
        </h1>
        <p class="text-xl text-gray-600 dark:text-gray-300">
          Latest news, updates, and insights
        </p>
      </div>
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
        {
          sortedPosts.map((post) => (
            <article class="bg-white dark:bg-gray-800 rounded-xl overflow-hidden shadow-lg hover:shadow-xl transition-shadow">
              <a href={`${prepareURL("/blog/" + post.slug)}`}>
                {post.data.cover && (
                  <img
                    src={post.data.cover}
                    alt={post.data.title}
                    class="h-48 w-full object-cover"
                    loading="lazy"
                  />
                )}
              </a>
              <div class="p-6">
                <div class="text-sm text-gray-500 dark:text-gray-400 mb-2">
                  {formatDate(post.data.date)}
                </div>
                <h2 class="text-xl font-bold mb-3 text-gray-900 dark:text-white">
                  <a
                    href={`${prepareURL("/blog/" + post.slug)}`}
                    class="hover:text-accent-teal transition-colors"
                  >
                    {post.data.title}
                  </a>
                </h2>
                <p class="text-gray-600 dark:text-gray-400 mb-4">
                  {post.data.description}
                </p>
                {post.data.tags.length > 0 && (
                  <div class="flex flex-wrap gap-2 mb-4">
                    {post.data.tags.map((tag) => (
                      <span class="text-xs px-2 py-1 bg-accent-teal/10 dark:bg-accent-teal/20 text-accent-teal rounded-full">
                        {tag}
                      </span>
                    ))}
                  </div>
                )}
                <a
                  href={`${prepareURL("/blog/" + post.slug)}`}
                  class="text-accent-teal dark:text-accent-green font-semibold hover:underline inline-flex items-center gap-1"
                >
                  Read more
                  <span>â†’</span>
                </a>
              </div>
            </article>
          ))
        }
      </div>
    </div>
  </section>
</Layout>
