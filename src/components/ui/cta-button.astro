---
import { prepareURL } from "../../lib/URL-helpers";

interface Props {
  url: string;
  text: string;
  variant?: "primary" | "secondary" | "ghost";
  className?: string;
  icon?: string;
  external?: boolean;
}

const {
  url,
  text,
  className = "",
  variant = "primary",
  icon,
  external,
} = Astro.props as Props;

const isExternal = external ?? /^(https?:)?\/\//.test(url);

if (!isExternal && !url.startsWith("/")) {
  throw new Error(`CtaButton url must start with '/' for internal links. Received: ${url}`);
}

const variants: Record<Required<Props>["variant"], string> = {
  primary:
    "bg-[var(--color-brand-600)] text-white shadow-lg shadow-blue-500/30 hover:bg-[var(--color-brand-700)]",
  secondary:
    "bg-white text-[var(--color-brand-700)] border border-black/10 hover:border-black/20",
  ghost:
    "bg-transparent text-[var(--color-gray-600)] hover:text-[var(--color-brand-600)]",
};
---

<a
  href={isExternal ? url : prepareURL(url)}
  class={`inline-flex items-center justify-center gap-2 px-6 py-3 text-base ${variants[variant]} rounded-[var(--radius-md)] font-semibold transition-all duration-200 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[var(--color-brand-500)] ${className}`}
  target={isExternal ? "_blank" : undefined}
  rel={isExternal ? "noreferrer" : undefined}
>
  {text}
  {icon && <span class="text-lg" aria-hidden="true">{icon}</span>}
</a>
